# Проблемы

## Существующие

### Клиентские проблемы

На текущий момент очевидны проблемы бизнес характера, но непонятны технические причины этих проблем. Это и является основной технической проблемой.

Нет точного понимания, на каком из этапов обработки заказа происходит сбой.

#### Гипотезы причин

Нехватка инстансов сервисов для обработки заказов.

Нестабильность сервисов. Слабая отказоустойчивость.

Низкая производительность БД.

Низкая производительность сервисов.

Неоптимальное взаимодействие фронтов и беков.

Нехватка аппаратных ресурсов.

Скорее всего отсутствует качественное управление тестпланом.

### Проблемы процесса разработки

Очень долги time to market.

Скорее всего много скрытых багов.

Почти полное отсуствие CI/CD.

На пулреквесте прогоняются только юниты. Этого недостаточно для проверки взаимодействия между сервисами.

Полностью отсуствует интеграционное автоматизированное тестирование.

Полностью отсуствует интеграционное автоматизированное развертывание.

Полностью отсуствует инкрементальное развертывание новой версии сервисов.

Одного тестировщика явно недостаточно для тестирования всех измененений.

Одного фронтендера с частичным знанием React скорее всего недостаточно. Проблемы могут быть во взаимодействии фронта и бека. Нужен минимум крепкий мидл, который обладает экспертизой в оптимизации фронта.

## Потенциальные

Проблемы с безопасностью. Утечка данных клиентов, раскрытие конфиденцильной информации, отказ в обслуживании и т.п. В описании нигде не увидел мер и способов обеспечения ИБ.

Полный отказ системы на долгое время с потенциальной потерей информации. Как следствие, разочарование клиентов, их потеря и снижение репутации на рынке.

# Инициативы

1. Внедрить мониторинг. Это самое первое, что нужно сделать. Мониторинг позволит выявить проблемные сервисы и проверить 90% гипотез.
2. Внедрить логирование. Логирование позволит выявить глубинные технические причины возникновения проблем. Тут можно применить тот же подход, что и с мониторингом.
3. Если позволяют аппаратные ресурсы, раз уже есть nginx, то сразу бы поднял по два инстанса сервисов. Если б стало лучше, то добавил бы еще инстансов. Это своего рода "выстрел вслепую", но 1) это дешево и 2) скорее всего поможет на первое время.
4. Сформировать технический план улучшения архитектуры. Конкретные меры зависят от руткозов, выявленных на этапе анализа метрик и логов. Мерами могут быть балансировка запросов, кеширование, шардирование/репликация баз, внедрение Backpressure и Circuit Breaker и т.п. Также мерами могут быть доработка кода. Но я бы с этим не спешил, так как, внедрение изменений кода занимает много времени. Это можно делать только, если обнаружаться проблемы, которые нельзя исправить на уровне архитектуры.
5. Нанять еще одного тестировщика. Крепкого мидла или сеньора, который сможет не просто писать автотесты, а организовать автотестирование. Сформировать процесс, выбрать инструменты, описать и донести до команды технические решения. Сформировать и внедрить тестпланы E2E тестирования на пулреквесте, regular и предрелизные тесты.
6. Внедрить трейсинг. Это не самое приоритетное, так как требует изменения кода. Но поможет глубже понять причины. Внедрять стоит либо по приоритету, либо сразу после мониторинга и логирования, если они не помогут.
7. Нанять еще по одному бекендеру по каждой технологгии: Java, С#. Причина: скорее всего доработок по техдолгу будет много. Чтобы не потерять объемы по бизнес фичам, нужны еще ресурсы.
8. Нанять еще одного devops. Либо подключить к этой работе одного из бекендеров. Причина: сейчас один девопс является бас фактором: отпуск, больниный или уход из комании - и весь сервис может встать.
9. Организовать ведение беклога и планирование техдолга. Уверен, после внедрения мониторинга и логирования его станет очень много.
10. Внедрить автоматизированное развертывание. Jenkins.

# Целевая архитектура через полгода

* Все запросы с фронта или открытого API попадают в контур инфраструктуры через API Gateway.
* Развернуто необходимое количество инстрансов каждого сервиса. Разворачивание новых инстансов выполняется вручную взависимости от метрик. Внедрение автобалансировки скорее всего за полгода не успеть. И система пока не такая уж нагруженная.
* У БД есть реплики.
* Есть балансировщики.
* Взаимодействие между сервисами выполняется через DNS или обратный прокси
* Есть мониторинг, логирование и трейсинг.
* Есть CI.

# Вне скоупа за полгода

* Внедрение оркестрации и Kubernates. За полгода слишком дорого с точки зрения погружения в продукт и его настройки. Пока не видно в этом необходимости.
* Внедрение CD. Пока можно пожить на ручном развертывании. Для внедрения CD необходимо очень высокое покрытие автотестами. Сначала нужно развивать его.
* Шардирование баз. Пока не видно в этом необходимости.
* Канареечные релизы. Дорого. Пока не очевидна необходимость.
* Трейсинг. Для его внедрения необходимы доработки в коде. Для начала можно решить более очевидные проблемы.
